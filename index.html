<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SalesManager 7.0 - Enhanced Professional Business Management System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Consolidated Styles - Professional Blue Theme */
        * { box-sizing: border-box; }
        html, body { height: 100%; }
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
        }
        a { color: inherit; }
        .app-hidden { display: none; }
        .header { background: linear-gradient(135deg, #1a237e 0%, #283593 100%); box-shadow: 0 4px 20px rgba(0,0,0,.3); }
        .header-content { max-width: 1400px; margin: 0 auto; padding: 14px 24px; display: flex; align-items: center; justify-content: space-between; }
        .logo-section h1 { margin: 0 0 4px; font-size: 22px; font-weight: 700; }
        .company-info { font-size: 13px; opacity: .9; }
        .user-info { display: flex; gap: 14px; align-items: center; }
        .notifications { position: relative; cursor: pointer; }
        .notification-count { position: absolute; top: -8px; right: -8px; background: #ff6b6b; color: white; border-radius: 20px; padding: 2px 6px; font-size: 11px; font-weight: 700; }
        .logout-btn { background: rgba(255,255,255,.12); border: 1px solid rgba(255,255,255,.3); color: #fff; padding: 8px 12px; border-radius: 6px; cursor: pointer; }
        .nav-bar { background: rgba(255,255,255,.08); border-bottom: 1px solid rgba(255,255,255,.2); backdrop-filter: blur(8px); }
        .nav-list { list-style: none; margin: 0 auto; padding: 0 24px; max-width: 1400px; display: flex; overflow-x: auto; }
        .nav-item { display: block; padding: 14px 18px; color: rgba(255,255,255,.92); text-decoration: none; border-bottom: 3px solid transparent; }
        .nav-item.active { border-bottom-color: #ffd700; color: #fff; background: rgba(255,255,255,.08); }
        .main-content { max-width: 1400px; margin: 0 auto; padding: 22px; }
        .content-section { display: none; animation: fade .25s ease; }
        .content-section.active { display: block; }
        @keyframes fade { from { opacity: 0; transform: translateY(6px);} to { opacity: 1; transform: translateY(0);} }
        .card { background: rgba(255,255,255,.96); color: #222; border-radius: 12px; border: 1px solid rgba(255,255,255,.3); box-shadow: 0 8px 28px rgba(0,0,0,.28); padding: 18px; margin-bottom: 18px; }
        .card-header { display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 10px; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px; }
        .dashboard-card { background: linear-gradient(135deg, #1a237e 0%, #283593 100%); color: #fff; border-radius: 12px; padding: 16px; display: flex; gap: 12px; align-items: center; }
        .dashboard-card .card-icon { font-size: 30px; opacity: .9; }
        .dashboard-card .card-value { font-size: 26px; font-weight: 800; margin-top: 4px; }
        .dashboard-card .card-change { font-size: 12px; opacity: .9; }
        .quick-actions { margin-top: 16px; }
        .action-buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 10px; }
        .action-btn { display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,.1); border: 1px solid rgba(255,255,255,.3); color: #fff; padding: 12px; border-radius: 10px; cursor: pointer; }
        .btn { border: none; border-radius: 8px; padding: 10px 14px; cursor: pointer; display: inline-flex; gap: 8px; align-items: center; }
        .btn-primary { background: linear-gradient(135deg, #1a237e, #3949ab); color: #fff; }
        .btn-success { background: linear-gradient(135deg, #2e7d32, #43a047); color: #fff; }
        .btn-warning { background: linear-gradient(135deg, #f57c00, #ffa000); color: #fff; }
        .btn-info { background: linear-gradient(135deg, #00838f, #00acc1); color: #fff; }
        .btn-secondary { background: #eceff1; color: #263238; }
        .btn-sm { padding: 6px 10px; font-size: 12px; }
        .sales-header, .header-actions { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
        .transaction-controls, .inventory-filters, .customer-filters, .report-filters { display: flex; gap: 12px; flex-wrap: wrap; margin: 10px 0; }
        .control-group, .filter-group { display: flex; gap: 8px; align-items: center; }
        input, select, textarea { padding: 10px; border-radius: 8px; border: 2px solid #e1e8ed; font-size: 14px; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #1a237e; box-shadow: 0 0 0 3px rgba(26,35,126,.1); }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 14px; margin-bottom: 12px; }
        .form-group { display: flex; flex-direction: column; gap: 6px; }
        .form-group.full-width { grid-column: 1/-1; }
        .table-container { border-radius: 12px; overflow: hidden; box-shadow: 0 8px 24px rgba(0,0,0,.18); }
        table { width: 100%; border-collapse: collapse; background: #fff; }
        th { background: linear-gradient(135deg, #1a237e, #283593); color: #fff; padding: 12px; text-align: left; font-size: 13px; }
        td { padding: 10px 12px; border-bottom: 1px solid #eceff1; font-size: 13px; }
        tr.no-records td { text-align: center; color: #6c757d; padding: 26px; font-style: italic; }
        .pos-container { display: grid; grid-template-columns: 2fr 1fr; gap: 16px; }
        .pos-items { background: #fff; border-radius: 12px; padding: 12px; min-height: 280px; }
        .pos-right { background: #fff; border-radius: 12px; padding: 12px; display: flex; flex-direction: column; gap: 12px; }
        .pos-categories { display: flex; gap: 8px; flex-wrap: wrap; margin: 10px 0; }
        .category-btn { background: #e3f2fd; border: 1px solid #90caf9; color: #0d47a1; padding: 6px 10px; border-radius: 20px; cursor: pointer; }
        .category-btn.active { background: #bbdefb; }
        .cart-items { flex: 1; overflow: auto; border: 1px dashed #cfd8dc; border-radius: 8px; padding: 10px; }
        .cart-item { display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #eceff1; padding: 8px 0; }
        .cart-summary { background: #f7f9fc; border: 1px solid #e3e8f0; border-radius: 10px; padding: 10px; }
        .summary-row { display: flex; align-items: center; justify-content: space-between; margin: 4px 0; }
        .summary-row.total { font-weight: 800; font-size: 16px; color: #1a237e; }
        .payment-section { display: grid; gap: 10px; }
        .footer { background: rgba(0,0,0,.18); border-top: 1px solid rgba(255,255,255,.14); padding: 16px; }
        .footer-content { max-width: 1400px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; }
        .badge { padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 700; }
        .badge.admin { background: #3949ab; color: #fff; }
        .badge.active { background: #2e7d32; color: #fff; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,.6); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { width: 460px; max-width: 92%; background: rgba(255,255,255,.96); border-radius: 12px; padding: 28px; box-shadow: 0 18px 36px rgba(0,0,0,.3); text-align: center; }
        .company-logo { font-size: 48px; color: #1a237e; margin-bottom: 8px; }
        .login-btn { width: 100%; padding: 12px; border-radius: 8px; border: 0; color: #fff; background: linear-gradient(135deg, #1a237e, #283593); cursor: pointer; margin-top: 6px; }
        .notification-container { position: fixed; top: 16px; right: 16px; display: grid; gap: 10px; z-index: 1100; }
        .notification { padding: 12px 14px; border-radius: 10px; color: #fff; font-weight: 600; box-shadow: 0 10px 20px rgba(0,0,0,.18); display: flex; gap: 10px; align-items: center; }
        .notification.success { background: #2e7d32; }
        .notification.error { background: #c62828; }
        .notification.info { background: #0277bd; }
        .notification.warning { background: #ef6c00; }
        @media (max-width: 980px) { .pos-container { grid-template-columns: 1fr; } .nav-list { padding: 0 12px; } }
        /* Print */
        @media print { .header, .nav-bar, .footer, .btn, .action-buttons, .notifications, .modal { display: none !important; } .card { box-shadow: none !important; border: 1px solid #ccc; } body { background: #fff !important; color: #000 !important; } }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="company-logo">
                <i class="fas fa-business-time"></i>
            </div>
            <h2>SalesManager 7.0</h2>
            <div class="company-display" id="loginCompanyDisplay">Enhanced Business Management System</div>
            <form class="login-form" onsubmit="login(event)">
                <div class="form-group">
                    <label for="username">Username:</label>
                    <input type="text" id="username" name="username" value="admin" required>
                </div>
                <div class="form-group">
                    <label for="password">Password:</label>
                    <input type="password" id="password" name="password" value="admin123" required>
                </div>
                <div class="form-group">
                    <label for="branch">Select Branch:</label>
                    <select id="branch" name="branch" required>
                        <option value="">Choose Branch...</option>
                        <option value="MAIN BRANCH" selected>MAIN BRANCH</option>
                        <option value="KAMPALA">KAMPALA</option>
                        <option value="ENTEBBE">ENTEBBE</option>
                        <option value="JINJA">JINJA</option>
                        <option value="MBARARA">MBARARA</option>
                        <option value="GULU">GULU</option>
                        <option value="ARUA">ARUA</option>
                        <option value="MBALE">MBALE</option>
                    </select>
                </div>
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app" class="app-hidden">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo-section">
                    <h1><i class="fas fa-business-time"></i> SalesManager 7.0</h1>
                    <div class="company-info">
                        <span class="company-name" id="companyDisplay">Enhanced Business Management System</span>
                        <span class="branch-name"> >> <span id="currentBranch">MAIN BRANCH</span></span>
                    </div>
                </div>
                <div class="user-info">
                    <div class="notifications" onclick="showNotifications()">
                        <i class="fas fa-bell"></i>
                        <span class="notification-count" id="notificationCount">0</span>
                    </div>
                    <div class="user-details">
                        <span class="username" id="currentUser">ADMIN</span>
                        <span class="user-role" id="currentRole">Administrator</span>
                    </div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-bar">
            <ul class="nav-list">
                <li><a href="#" data-section="dashboard" class="nav-item active">
                    <i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li><a href="#" data-section="transactions" class="nav-item" data-permission="transactions">
                    <i class="fas fa-exchange-alt"></i> Transactions</a></li>
                <li><a href="#" data-section="sales" class="nav-item" data-permission="sales">
                    <i class="fas fa-shopping-cart"></i> Sales & POS</a></li>
                <li><a href="#" data-section="inventory" class="nav-item" data-permission="inventory">
                    <i class="fas fa-boxes"></i> Inventory</a></li>
                <li><a href="#" data-section="customers" class="nav-item" data-permission="customers">
                    <i class="fas fa-users"></i> Customers</a></li>
                <li><a href="#" data-section="suppliers" class="nav-item" data-permission="suppliers">
                    <i class="fas fa-truck"></i> Suppliers</a></li>
                <li><a href="#" data-section="accounting" class="nav-item" data-permission="accounting">
                    <i class="fas fa-calculator"></i> Accounting</a></li>
                <li><a href="#" data-section="reports" class="nav-item" data-permission="reports">
                    <i class="fas fa-chart-bar"></i> Reports</a></li>
                <li><a href="#" data-section="settings" class="nav-item" data-permission="settings">
                    <i class="fas fa-cog"></i> Settings</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Section -->
            <section id="dashboard" class="content-section active">
                <div class="dashboard-grid">
                    <div class="dashboard-card sales-card">
                        <div class="card-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="card-content">
                            <h3>Today's Sales</h3>
                            <div class="card-value" id="todaySales">$0.00</div>
                            <div class="card-change positive" id="salesChange">+0%</div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card inventory-card">
                        <div class="card-icon">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="card-content">
                            <h3>Total Items</h3>
                            <div class="card-value" id="totalItems">0</div>
                            <div class="card-info" id="lowStockAlert">Low Stock: 0</div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card customers-card">
                        <div class="card-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="card-content">
                            <h3>Active Customers</h3>
                            <div class="card-value" id="activeCustomers">0</div>
                            <div class="card-info">This Month</div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card profit-card">
                        <div class="card-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="card-content">
                            <h3>Monthly Profit</h3>
                            <div class="card-value" id="monthlyProfit">$0.00</div>
                            <div class="card-change" id="profitChange">+0%</div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Activity -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Recent Activity</h3>
                        <button class="btn btn-primary" onclick="refreshDashboard()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    <div class="activity-list" id="recentActivity">
                        <div class="activity-item">
                            <i class="fas fa-info-circle"></i>
                            <span>Welcome to SalesManager 7.0! Start by adding your first inventory items.</span>
                            <span class="activity-time">Just now</span>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="quick-actions">
                    <h3>Quick Actions</h3>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="quickSale()">
                            <i class="fas fa-cash-register"></i>
                            <span>Quick Sale</span>
                        </button>
                        <button class="action-btn" onclick="addInventory()">
                            <i class="fas fa-plus-circle"></i>
                            <span>Add Item</span>
                        </button>
                        <button class="action-btn" onclick="newCustomer()">
                            <i class="fas fa-user-plus"></i>
                            <span>New Customer</span>
                        </button>
                        <button class="action-btn" onclick="viewReports()">
                            <i class="fas fa-chart-bar"></i>
                            <span>View Reports</span>
                        </button>
                        <button class="action-btn print-allowed" onclick="printDashboard()">
                            <i class="fas fa-print"></i>
                            <span>Print Summary</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Transactions Section -->
            <section id="transactions" class="content-section">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-exchange-alt"></i> Transaction Management</h2>
                        <div class="header-actions">
                            <button class="btn btn-success" onclick="newTransaction()">
                                <i class="fas fa-plus"></i> New Transaction
                            </button>
                            <button class="btn btn-info print-allowed" onclick="printTransactions()">
                                <i class="fas fa-print"></i> Print
                            </button>
                        </div>
                    </div>
                    
                    <div class="transaction-controls">
                        <div class="control-group">
                            <label>Transaction Type:</label>
                            <select id="transactionType" onchange="loadTransactionModule()">
                                <option value="">Select Transaction Type...</option>
                                <optgroup label="Sales Transactions">
                                    <option value="sales-invoice">Sales Invoice</option>
                                    <option value="sales-return">Sales Return</option>
                                    <option value="sales-quote">Sales Quotation</option>
                                    <option value="sales-order">Sales Order</option>
                                </optgroup>
                                <optgroup label="Purchase Transactions">
                                    <option value="purchase-order">Purchase Order</option>
                                    <option value="purchase-invoice">Purchase Invoice</option>
                                    <option value="purchase-return">Purchase Return</option>
                                </optgroup>
                                <optgroup label="Payment Transactions">
                                    <option value="cash-receipt">Cash Receipt</option>
                                    <option value="cash-payment">Cash Payment</option>
                                    <option value="bank-deposit">Bank Deposit</option>
                                    <option value="bank-withdrawal">Bank Withdrawal</option>
                                </optgroup>
                                <optgroup label="Inventory Transactions">
                                    <option value="stock-adjustment">Stock Adjustment</option>
                                    <option value="stock-transfer">Stock Transfer</option>
                                    <option value="stock-take">Stock Take</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <label>Date Range:</label>
                            <input type="date" id="transactionFromDate" onchange="filterTransactions()">
                            <input type="date" id="transactionToDate" onchange="filterTransactions()">
                        </div>
                        
                        <div class="control-group">
                            <label>Status:</label>
                            <select id="transactionStatus" onchange="filterTransactions()">
                                <option value="">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                                <option value="draft">Draft</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="transactionModule">
                        <div class="empty-state">
                            <i class="fas fa-clipboard-list"></i>
                            <h3>Select Transaction Type</h3>
                            <p>Choose a transaction type from the dropdown above to get started.</p>
                        </div>
                    </div>
                    
                    <!-- Transaction History Table -->
                    <div class="table-container">
                        <table id="transactionsTable">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Reference</th>
                                    <th>Party</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="transactionsTableBody">
                                <tr class="no-records">
                                    <td colspan="7">No transactions found. Create your first transaction above.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Sales & POS Section -->
            <section id="sales" class="content-section">
                <div class="sales-header">
                    <h2><i class="fas fa-shopping-cart"></i> Sales & Point of Sale</h2>
                    <div class="sales-actions">
                        <button class="btn btn-success" onclick="openPOS()">
                            <i class="fas fa-cash-register"></i> Open POS
                        </button>
                        <button class="btn btn-primary" onclick="newSale()">
                            <i class="fas fa-plus"></i> New Sale
                        </button>
                        <button class="btn btn-info print-allowed" onclick="printSales()">
                            <i class="fas fa-print"></i> Print
                        </button>
                    </div>
                </div>
                
                <!-- POS Interface -->
                <div id="posInterface" class="pos-container" style="display: none;">
                    <div class="pos-left">
                        <div class="pos-search">
                            <input type="text" id="itemSearch" placeholder="Search items..." onkeyup="searchItems()">
                            <button class="btn btn-primary" onclick="searchItems()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        
                        <div class="pos-categories">
                            <button class="category-btn active" onclick="filterByCategory('all')">All Items</button>
                            <button class="category-btn" onclick="filterByCategory('electronics')">Electronics</button>
                            <button class="category-btn" onclick="filterByCategory('clothing')">Clothing</button>
                            <button class="category-btn" onclick="filterByCategory('food')">Food & Beverage</button>
                            <button class="category-btn" onclick="filterByCategory('furniture')">Furniture</button>
                            <button class="category-btn" onclick="filterByCategory('other')">Other</button>
                        </div>
                        
                        <div class="pos-items" id="posItems">
                            <!-- Items will be loaded here dynamically -->
                        </div>
                    </div>
                    
                    <div class="pos-right">
                        <div class="cart-header">
                            <h3>Shopping Cart</h3>
                            <button class="btn btn-warning" onclick="clearCart()">
                                <i class="fas fa-trash"></i> Clear
                            </button>
                        </div>
                        
                        <div class="cart-items" id="cartItems">
                            <div class="empty-cart">
                                <i class="fas fa-shopping-cart"></i>
                                <p>Cart is empty</p>
                            </div>
                        </div>
                        
                        <div class="cart-summary">
                            <div class="summary-row">
                                <span>Subtotal:</span>
                                <span id="cartSubtotal">$0.00</span>
                            </div>
                            <div class="summary-row">
                                <span>Tax:</span>
                                <span id="cartTax">$0.00</span>
                            </div>
                            <div class="summary-row">
                                <span>Discount:</span>
                                <span id="cartDiscount">$0.00</span>
                            </div>
                            <div class="summary-row total">
                                <span>Total:</span>
                                <span id="cartTotal">$0.00</span>
                            </div>
                        </div>
                        
                        <div class="payment-section">
                            <div class="payment-method">
                                <label>Payment Method:</label>
                                <select id="paymentMethod">
                                    <option value="cash">Cash</option>
                                    <option value="card">Credit/Debit Card</option>
                                    <option value="mobile">Mobile Money</option>
                                    <option value="bank">Bank Transfer</option>
                                    <option value="credit">Credit Sale</option>
                                </select>
                            </div>
                            
                            <div class="payment-amount">
                                <label>Amount Paid:</label>
                                <input type="number" id="amountPaid" step="0.01" onchange="calculateChange()">
                            </div>
                            
                            <div class="change-amount">
                                <span>Change: </span>
                                <span id="changeAmount">$0.00</span>
                            </div>
                            
                            <div class="checkout-actions">
                                <button class="btn btn-success btn-large" onclick="processPayment()">
                                    <i class="fas fa-credit-card"></i> Process Payment
                                </button>
                                <button class="btn btn-info print-allowed" onclick="printReceipt()">
                                    <i class="fas fa-print"></i> Print Receipt
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sales List -->
                <div id="salesList" class="card">
                    <div class="card-header">
                        <h3>Recent Sales</h3>
                        <div class="sales-filters">
                            <input type="date" id="salesFromDate" onchange="filterSales()">
                            <input type="date" id="salesToDate" onchange="filterSales()">
                            <select id="salesStatusFilter" onchange="filterSales()">
                                <option value="">All Status</option>
                                <option value="completed">Completed</option>
                                <option value="pending">Pending</option>
                                <option value="refunded">Refunded</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Invoice #</th>
                                    <th>Customer</th>
                                    <th>Items</th>
                                    <th>Total</th>
                                    <th>Payment</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="salesTableBody">
                                <tr class="no-records">
                                    <td colspan="8">No sales records found.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Inventory Section -->
            <section id="inventory" class="content-section">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-boxes"></i> Inventory Management</h2>
                        <div class="header-actions">
                            <button class="btn btn-success" onclick="addNewItem()">
                                <i class="fas fa-plus"></i> Add Item
                            </button>
                            <button class="btn btn-warning" onclick="stockAdjustment()">
                                <i class="fas fa-edit"></i> Stock Adjustment
                            </button>
                            <button class="btn btn-info" onclick="importItems()">
                                <i class="fas fa-upload"></i> Import Items
                            </button>
                            <button class="btn btn-primary" onclick="exportInventory()">
                                <i class="fas fa-download"></i> Export
                            </button>
                            <button class="btn btn-info print-allowed" onclick="printInventory()">
                                <i class="fas fa-print"></i> Print
                            </button>
                        </div>
                    </div>
                    
                    <!-- Inventory Form -->
                    <div id="inventoryForm" class="form-section" style="display: none;">
                        <form onsubmit="saveInventoryItem(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Item Code:</label>
                                    <input type="text" id="itemCode" required>
                                </div>
                                <div class="form-group">
                                    <label>Item Name:</label>
                                    <input type="text" id="itemName" required>
                                </div>
                                <div class="form-group">
                                    <label>Category:</label>
                                    <select id="itemCategory" required>
                                        <option value="">Select Category</option>
                                        <option value="electronics">Electronics</option>
                                        <option value="clothing">Clothing</option>
                                        <option value="food">Food & Beverage</option>
                                        <option value="furniture">Furniture</option>
                                        <option value="automotive">Automotive</option>
                                        <option value="books">Books & Media</option>
                                        <option value="health">Health & Beauty</option>
                                        <option value="sports">Sports & Recreation</option>
                                        <option value="toys">Toys & Games</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Brand:</label>
                                    <input type="text" id="itemBrand">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Cost Price:</label>
                                    <input type="number" id="costPrice" step="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label>Selling Price:</label>
                                    <input type="number" id="sellingPrice" step="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label>Unit:</label>
                                    <select id="itemUnit" required>
                                        <option value="pcs">Pieces</option>
                                        <option value="kg">Kilograms</option>
                                        <option value="lbs">Pounds</option>
                                        <option value="liters">Liters</option>
                                        <option value="meters">Meters</option>
                                        <option value="boxes">Boxes</option>
                                        <option value="sets">Sets</option>
                                        <option value="dozens">Dozens</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Initial Stock:</label>
                                    <input type="number" id="initialStock" min="0" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Minimum Stock Level:</label>
                                    <input type="number" id="minStockLevel" min="0" required>
                                </div>
                                <div class="form-group">
                                    <label>Maximum Stock Level:</label>
                                    <input type="number" id="maxStockLevel" min="0">
                                </div>
                                <div class="form-group">
                                    <label>Reorder Point:</label>
                                    <input type="number" id="reorderPoint" min="0">
                                </div>
                                <div class="form-group">
                                    <label>Location/Shelf:</label>
                                    <input type="text" id="itemLocation" placeholder="A1-B2">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Supplier:</label>
                                    <select id="itemSupplier">
                                        <option value="">Select Supplier</option>
                                        <!-- Suppliers will be loaded dynamically -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Barcode:</label>
                                    <input type="text" id="itemBarcode">
                                    <button type="button" class="btn btn-sm" onclick="generateBarcode()">
                                        <i class="fas fa-barcode"></i> Generate
                                    </button>
                                </div>
                                <div class="form-group">
                                    <label>Tax Rate (%):</label>
                                    <input type="number" id="taxRate" step="0.01" value="0">
                                </div>
                                <div class="form-group">
                                    <label>Status:</label>
                                    <select id="itemStatus">
                                        <option value="active">Active</option>
                                        <option value="inactive">Inactive</option>
                                        <option value="discontinued">Discontinued</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label>Description:</label>
                                    <textarea id="itemDescription" rows="3"></textarea>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> Save Item
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="cancelItemForm()">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                                <button type="button" class="btn btn-warning" onclick="clearItemForm()">
                                    <i class="fas fa-broom"></i> Clear
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Inventory Filters -->
                    <div class="inventory-filters">
                        <div class="filter-group">
                            <input type="text" id="inventorySearch" placeholder="Search items..." onkeyup="filterInventory()">
                        </div>
                        <div class="filter-group">
                            <select id="categoryFilter" onchange="filterInventory()">
                                <option value="">All Categories</option>
                                <option value="electronics">Electronics</option>
                                <option value="clothing">Clothing</option>
                                <option value="food">Food & Beverage</option>
                                <option value="furniture">Furniture</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <select id="stockFilter" onchange="filterInventory()">
                                <option value="">All Stock Levels</option>
                                <option value="in-stock">In Stock</option>
                                <option value="low-stock">Low Stock</option>
                                <option value="out-of-stock">Out of Stock</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <select id="statusFilter" onchange="filterInventory()">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="discontinued">Discontinued</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Inventory Table -->
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>Name</th>
                                    <th>Category</th>
                                    <th>Stock</th>
                                    <th>Cost Price</th>
                                    <th>Selling Price</th>
                                    <th>Margin</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTableBody">
                                <tr class="no-records">
                                    <td colspan="9">No inventory items found. Add your first item above.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Customers Section -->
            <section id="customers" class="content-section">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-users"></i> Customer Management</h2>
                        <div class="header-actions">
                            <button class="btn btn-success" onclick="addNewCustomer()">
                                <i class="fas fa-user-plus"></i> Add Customer
                            </button>
                            <button class="btn btn-info" onclick="importCustomers()">
                                <i class="fas fa-upload"></i> Import
                            </button>
                            <button class="btn btn-primary" onclick="exportCustomers()">
                                <i class="fas fa-download"></i> Export
                            </button>
                            <button class="btn btn-info print-allowed" onclick="printCustomers()">
                                <i class="fas fa-print"></i> Print
                            </button>
                        </div>
                    </div>
                    
                    <!-- Customer Form -->
                    <div id="customerForm" class="form-section" style="display: none;">
                        <form onsubmit="saveCustomer(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Customer ID:</label>
                                    <input type="text" id="customerId" readonly>
                                </div>
                                <div class="form-group">
                                    <label>Customer Type:</label>
                                    <select id="customerType" required>
                                        <option value="individual">Individual</option>
                                        <option value="business">Business</option>
                                        <option value="wholesale">Wholesale</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Title:</label>
                                    <select id="customerTitle">
                                        <option value="">Select Title</option>
                                        <option value="Mr">Mr.</option>
                                        <option value="Mrs">Mrs.</option>
                                        <option value="Ms">Ms.</option>
                                        <option value="Dr">Dr.</option>
                                        <option value="Prof">Prof.</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>First Name:</label>
                                    <input type="text" id="firstName" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Last Name:</label>
                                    <input type="text" id="lastName" required>
                                </div>
                                <div class="form-group">
                                    <label>Company Name:</label>
                                    <input type="text" id="companyName">
                                </div>
                                <div class="form-group">
                                    <label>Email:</label>
                                    <input type="email" id="customerEmail">
                                </div>
                                <div class="form-group">
                                    <label>Phone:</label>
                                    <input type="tel" id="customerPhone" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Alternative Phone:</label>
                                    <input type="tel" id="altPhone">
                                </div>
                                <div class="form-group">
                                    <label>Date of Birth:</label>
                                    <input type="date" id="dateOfBirth">
                                </div>
                                <div class="form-group">
                                    <label>Gender:</label>
                                    <select id="gender">
                                        <option value="">Select Gender</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>ID/Passport Number:</label>
                                    <input type="text" id="idNumber">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Address Line 1:</label>
                                    <input type="text" id="address1">
                                </div>
                                <div class="form-group">
                                    <label>Address Line 2:</label>
                                    <input type="text" id="address2">
                                </div>
                                <div class="form-group">
                                    <label>City:</label>
                                    <input type="text" id="city">
                                </div>
                                <div class="form-group">
                                    <label>State/Region:</label>
                                    <input type="text" id="state">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Postal Code:</label>
                                    <input type="text" id="postalCode">
                                </div>
                                <div class="form-group">
                                    <label>Country:</label>
                                    <select id="country">
                                        <option value="Uganda">Uganda</option>
                                        <option value="Kenya">Kenya</option>
                                        <option value="Tanzania">Tanzania</option>
                                        <option value="Rwanda">Rwanda</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Credit Limit:</label>
                                    <input type="number" id="creditLimit" step="0.01" value="0">
                                </div>
                                <div class="form-group">
                                    <label>Payment Terms:</label>
                                    <select id="paymentTerms">
                                        <option value="cash">Cash</option>
                                        <option value="net15">Net 15 Days</option>
                                        <option value="net30">Net 30 Days</option>
                                        <option value="net60">Net 60 Days</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label>Notes:</label>
                                    <textarea id="customerNotes" rows="3"></textarea>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> Save Customer
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="cancelCustomerForm()">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                                <button type="button" class="btn btn-warning" onclick="clearCustomerForm()">
                                    <i class="fas fa-broom"></i> Clear
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Customer Filters -->
                    <div class="customer-filters">
                        <div class="filter-group">
                            <input type="text" id="customerSearch" placeholder="Search customers..." onkeyup="filterCustomers()">
                        </div>
                        <div class="filter-group">
                            <select id="customerTypeFilter" onchange="filterCustomers()">
                                <option value="">All Types</option>
                                <option value="individual">Individual</option>
                                <option value="business">Business</option>
                                <option value="wholesale">Wholesale</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <select id="customerStatusFilter" onchange="filterCustomers()">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Customers Table -->
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Total Purchases</th>
                                    <th>Credit Limit</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="customersTableBody">
                                <tr class="no-records">
                                    <td colspan="9">No customers found. Add your first customer above.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Suppliers Section -->
            <section id="suppliers" class="content-section">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-truck"></i> Supplier Management</h2>
                        <div class="header-actions">
                            <button class="btn btn-success" onclick="addNewSupplier()">
                                <i class="fas fa-plus"></i> Add Supplier
                            </button>
                            <button class="btn btn-info" onclick="importSuppliers()">
                                <i class="fas fa-upload"></i> Import
                            </button>
                            <button class="btn btn-primary" onclick="exportSuppliers()">
                                <i class="fas fa-download"></i> Export
                            </button>
                            <button class="btn btn-info print-allowed" onclick="printSuppliers()">
                                <i class="fas fa-print"></i> Print
                            </button>
                        </div>
                    </div>
                    
                    <!-- Similar structure as customers but for suppliers -->
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Company Name</th>
                                    <th>Contact Person</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Total Purchases</th>
                                    <th>Payment Terms</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="suppliersTableBody">
                                <tr class="no-records">
                                    <td colspan="9">No suppliers found. Add your first supplier above.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Accounting Section -->
            <section id="accounting" class="content-section">
                <div class="accounting-dashboard">
                    <div class="accounting-summary">
                        <div class="summary-card assets">
                            <h3>Total Assets</h3>
                            <div class="amount" id="totalAssets">$0.00</div>
                        </div>
                        <div class="summary-card liabilities">
                            <h3>Total Liabilities</h3>
                            <div class="amount" id="totalLiabilities">$0.00</div>
                        </div>
                        <div class="summary-card equity">
                            <h3>Total Equity</h3>
                            <div class="amount" id="totalEquity">$0.00</div>
                        </div>
                        <div class="summary-card profit">
                            <h3>Net Profit</h3>
                            <div class="amount" id="netProfit">$0.00</div>
                        </div>
                    </div>
                    
                    <div class="accounting-modules">
                        <div class="module-card" onclick="openAccountingModule('chart-of-accounts')">
                            <i class="fas fa-list"></i>
                            <h3>Chart of Accounts</h3>
                            <p>Manage your account structure</p>
                        </div>
                        
                        <div class="module-card" onclick="openAccountingModule('general-ledger')">
                            <i class="fas fa-book"></i>
                            <h3>General Ledger</h3>
                            <p>View all account transactions</p>
                        </div>
                        
                        <div class="module-card" onclick="openAccountingModule('trial-balance')">
                            <i class="fas fa-balance-scale"></i>
                            <h3>Trial Balance</h3>
                            <p>Verify account balances</p>
                        </div>
                        
                        <div class="module-card" onclick="openAccountingModule('profit-loss')">
                            <i class="fas fa-chart-line"></i>
                            <h3>Profit & Loss</h3>
                            <p>Income statement report</p>
                        </div>
                        
                        <div class="module-card" onclick="openAccountingModule('balance-sheet')">
                            <i class="fas fa-clipboard-list"></i>
                            <h3>Balance Sheet</h3>
                            <p>Financial position statement</p>
                        </div>
                        
                        <div class="module-card" onclick="openAccountingModule('cash-flow')">
                            <i class="fas fa-money-bill-wave"></i>
                            <h3>Cash Flow</h3>
                            <p>Cash movement analysis</p>
                        </div>
                    </div>
                </div>
                
                <!-- Accounting Module Content -->
                <div id="accountingModuleContent" class="card" style="display: none;">
                    <div class="card-header">
                        <h3 id="accountingModuleTitle">Accounting Module</h3>
                        <button class="btn btn-secondary" onclick="closeAccountingModule()">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                    <div id="accountingModuleBody">
                        <!-- Module content will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Reports Section -->
            <section id="reports" class="content-section">
                <div class="reports-dashboard">
                    <div class="report-categories">
                        <div class="category-card" onclick="loadReportCategory('sales')">
                            <i class="fas fa-chart-bar"></i>
                            <h3>Sales Reports</h3>
                            <p>Sales performance and analysis</p>
                        </div>
                        
                        <div class="category-card" onclick="loadReportCategory('inventory')">
                            <i class="fas fa-boxes"></i>
                            <h3>Inventory Reports</h3>
                            <p>Stock levels and movements</p>
                        </div>
                        
                        <div class="category-card" onclick="loadReportCategory('financial')">
                            <i class="fas fa-calculator"></i>
                            <h3>Financial Reports</h3>
                            <p>Accounting and financial analysis</p>
                        </div>
                        
                        <div class="category-card" onclick="loadReportCategory('customer')">
                            <i class="fas fa-users"></i>
                            <h3>Customer Reports</h3>
                            <p>Customer analysis and metrics</p>
                        </div>
                    </div>
                    
                    <!-- Report Content -->
                    <div id="reportContent" class="card" style="display: none;">
                        <div class="card-header">
                            <h3 id="reportTitle">Report</h3>
                            <div class="report-actions">
                                <button class="btn btn-primary" onclick="generateReport()">
                                    <i class="fas fa-play"></i> Generate
                                </button>
                                <button class="btn btn-success" onclick="exportReport()">
                                    <i class="fas fa-download"></i> Export
                                </button>
                                <button class="btn btn-info print-allowed" onclick="printReport()">
                                    <i class="fas fa-print"></i> Print
                                </button>
                                <button class="btn btn-secondary" onclick="closeReport()">
                                    <i class="fas fa-times"></i> Close
                                </button>
                            </div>
                        </div>
                        
                        <div class="report-filters">
                            <div class="filter-group">
                                <label>From Date:</label>
                                <input type="date" id="reportFromDate">
                            </div>
                            <div class="filter-group">
                                <label>To Date:</label>
                                <input type="date" id="reportToDate">
                            </div>
                            <div class="filter-group" id="reportSpecificFilters">
                                <!-- Specific filters will be added based on report type -->
                            </div>
                        </div>
                        
                        <div id="reportBody">
                            <!-- Report content will be generated here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings" class="content-section">
                <div class="settings-nav">
                    <div class="settings-tabs">
                        <button class="tab-btn active" onclick="showSettingsTab('company')">
                            <i class="fas fa-building"></i> Company
                        </button>
                        <button class="tab-btn" onclick="showSettingsTab('users')">
                            <i class="fas fa-users-cog"></i> Users
                        </button>
                        <button class="tab-btn" onclick="showSettingsTab('permissions')">
                            <i class="fas fa-shield-alt"></i> Permissions
                        </button>
                        <button class="tab-btn" onclick="showSettingsTab('system')">
                            <i class="fas fa-cogs"></i> System
                        </button>
                        <button class="tab-btn" onclick="showSettingsTab('backup')">
                            <i class="fas fa-database"></i> Backup
                        </button>
                    </div>
                </div>
                
                <!-- Company Settings -->
                <div id="company-settings" class="settings-tab active">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-building"></i> Company Information</h3>
                        </div>
                        
                        <form onsubmit="saveCompanySettings(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Company Name:</label>
                                    <input type="text" id="companyName" value="Enhanced Business Management System">
                                </div>
                                <div class="form-group">
                                    <label>Business Registration No:</label>
                                    <input type="text" id="businessRegNo">
                                </div>
                                <div class="form-group">
                                    <label>Tax ID Number:</label>
                                    <input type="text" id="taxIdNumber">
                                </div>
                                <div class="form-group">
                                    <label>Business Type:</label>
                                    <select id="businessType">
                                        <option value="retail">Retail</option>
                                        <option value="wholesale">Wholesale</option>
                                        <option value="manufacturing">Manufacturing</option>
                                        <option value="service">Service</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Phone:</label>
                                    <input type="tel" id="companyPhone">
                                </div>
                                <div class="form-group">
                                    <label>Email:</label>
                                    <input type="email" id="companyEmail">
                                </div>
                                <div class="form-group">
                                    <label>Website:</label>
                                    <input type="url" id="companyWebsite">
                                </div>
                                <div class="form-group">
                                    <label>Currency:</label>
                                    <select id="companyCurrency">
                                        <option value="USD">USD - US Dollar</option>
                                        <option value="UGX">UGX - Ugandan Shilling</option>
                                        <option value="KES">KES - Kenyan Shilling</option>
                                        <option value="TZS">TZS - Tanzanian Shilling</option>
                                        <option value="EUR">EUR - Euro</option>
                                        <option value="GBP">GBP - British Pound</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label>Address:</label>
                                    <textarea id="companyAddress" rows="3"></textarea>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="enableTax"> Enable Tax
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label>Tax Rate (%):</label>
                                    <input type="number" id="taxRate" step="0.01" value="18">
                                </div>
                                <div class="form-group">
                                    <label>Fiscal Year Start:</label>
                                    <select id="fiscalYearStart">
                                        <option value="01">January</option>
                                        <option value="07">July</option>
                                        <option value="04">April</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> Save Company Settings
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- User Management -->
                <div id="users-settings" class="settings-tab">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-users-cog"></i> User Management</h3>
                            <button class="btn btn-success" onclick="addNewUser()">
                                <i class="fas fa-user-plus"></i> Add User
                            </button>
                        </div>
                        
                        <!-- User Form -->
                        <div id="userForm" class="form-section" style="display: none;">
                            <form onsubmit="saveUser(event)">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Username:</label>
                                        <input type="text" id="username" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Full Name:</label>
                                        <input type="text" id="fullName" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Email:</label>
                                        <input type="email" id="userEmail">
                                    </div>
                                    <div class="form-group">
                                        <label>Role:</label>
                                        <select id="userRole" required>
                                            <option value="admin">Administrator</option>
                                            <option value="manager">Manager</option>
                                            <option value="cashier">Cashier</option>
                                            <option value="staff">Staff</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Password:</label>
                                        <input type="password" id="userPassword" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Confirm Password:</label>
                                        <input type="password" id="confirmPassword" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Status:</label>
                                        <select id="userStatus">
                                            <option value="active">Active</option>
                                            <option value="inactive">Inactive</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-success">
                                        <i class="fas fa-save"></i> Save User
                                    </button>
                                    <button type="button" class="btn btn-secondary" onclick="cancelUserForm()">
                                        <i class="fas fa-times"></i> Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Users Table -->
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Username</th>
                                        <th>Full Name</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Status</th>
                                        <th>Last Login</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <tr>
                                        <td>admin</td>
                                        <td>System Administrator</td>
                                        <td>admin@system.com</td>
                                        <td><span class="badge admin">Administrator</span></td>
                                        <td><span class="badge active">Active</span></td>
                                        <td>Just now</td>
                                        <td>
                                            <button class="btn btn-sm btn-primary" onclick="editUser('admin')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Permissions Settings -->
                <div id="permissions-settings" class="settings-tab">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-shield-alt"></i> User Permissions</h3>
                            <div class="permission-info">
                                <i class="fas fa-info-circle"></i>
                                <span>Admin has full access. Printing is available to all users.</span>
                            </div>
                        </div>
                        
                        <div class="permissions-grid">
                            <div class="permission-section">
                                <h4>Dashboard & Overview</h4>
                                <div class="permission-items">
                                    <label class="permission-item">
                                        <input type="checkbox" name="dashboard" checked disabled>
                                        <span>View Dashboard</span>
                                        <small>Access to main dashboard (Always enabled)</small>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="permission-section">
                                <h4>Transactions</h4>
                                <div class="permission-items">
                                    <label class="permission-item">
                                        <input type="checkbox" name="transactions-view" id="perm-transactions-view">
                                        <span>View Transactions</span>
                                    </label>
                                    <label class="permission-item">
                                        <input type="checkbox" name="transactions-create" id="perm-transactions-create">
                                        <span>Create Transactions</span>
                                    </label>
                                    <label class="permission-item">
                                        <input type="checkbox" name="transactions-edit" id="perm-transactions-edit">
                                        <span>Edit Transactions</span>
                                    </label>
                                    <label class="permission-item">
                                        <input type="checkbox" name="transactions-delete" id="perm-transactions-delete">
                                        <span>Delete Transactions</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="permission-section">
                                <h4>Sales & POS</h4>
                                <div class="permission-items">
                                    <label class="permission-item">
                                        <input type="checkbox" name="sales-view" id="perm-sales-view">
                                        <span>View Sales</span>
                                    </label>
                                    <label class="permission-item">
                                        <input type="checkbox" name="sales-create" id="perm-sales-create">
                                        <span>Create Sales</span>
                                    </label>
                                    <label class="permission-item">
                                        <input type="checkbox" name="pos-access" id="perm-pos-access">
                                        <span>Access POS System</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="permission-section">
                                <h4>Inventory Management</h4>
                                <div class="permission-items">
                                    <label class="permission-item">
                                        <input type="checkbox" name="inventory-view" id="perm-inventory-view">
                                        <span>View Inventory</span>
                                    </label>
                                    <label class="permission-item">
                                        <input type="checkbox" name="inventory-create" id="perm-inventory-create">
                                        <span>Add Items</span>
                                    </label>
                                    <label class="permission-item">
                                        <input type="checkbox" name="inventory-edit" id="perm-inventory-edit">
                                        <span>Edit Items</span>
                                    </label>
                                    <label class="permission-item">
                                        <input type="checkbox" name="inventory-delete" id="perm-inventory-delete">
                                        <span>Delete Items</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="permission-section">
                                <h4>Customer Management</h4>
                                <div class="permission-items">
                                    <label class="permission-item">
                                        <input type="checkbox" name="customers-view" id="perm-customers-view">
                                        <span>View Customers</span>
                                    </label>
                                    <label class="permission-item">
                                        <input type="checkbox" name="customers-create" id="perm-customers-create">
                                        <span>Add Customers</span>
                                    </label>
                                    <label class="permission-item">
                                        <input type="checkbox" name="customers-edit" id="perm-customers-edit">
                                        <span>Edit Customers</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="permission-section">
                                <h4>Supplier Management</h4>
                                <div class="permission-items">
                                    <label class="permission-item">
                                        <input type="checkbox" name="suppliers-view" id="perm-suppliers-view">
                                        <span>View Suppliers</span>
                                    </label>
                                    <label class="permission-item">
                                        <input type="checkbox" name="suppliers-create" id="perm-suppliers-create">
                                        <span>Add Suppliers</span>
                                    </label>
                                    <label class="permission-item">
                                        <input type="checkbox" name="suppliers-edit" id="perm-suppliers-edit">
                                        <span>Edit Suppliers</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="permission-section">
                                <h4>Accounting</h4>
                                <div class="permission-items">
                                    <label class="permission-item">
                                        <input type="checkbox" name="accounting-view" id="perm-accounting-view">
                                        <span>View Accounting</span>
                                    </label>
                                    <label class="permission-item">
                                        <input type="checkbox" name="accounting-create" id="perm-accounting-create">
                                        <span>Create Entries</span>
                                    </label>
                                    <label class="permission-item">
                                        <input type="checkbox" name="accounting-edit" id="perm-accounting-edit">
                                        <span>Edit Entries</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="permission-section">
                                <h4>Reports</h4>
                                <div class="permission-items">
                                    <label class="permission-item">
                                        <input type="checkbox" name="reports-view" id="perm-reports-view">
                                        <span>View Reports</span>
                                    </label>
                                    <label class="permission-item">
                                        <input type="checkbox" name="reports-export" id="perm-reports-export">
                                        <span>Export Reports</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="permission-section">
                                <h4>System Settings</h4>
                                <div class="permission-items">
                                    <label class="permission-item">
                                        <input type="checkbox" name="settings-access" id="perm-settings-access">
                                        <span>Access Settings</span>
                                    </label>
                                    <label class="permission-item">
                                        <input type="checkbox" name="settings-modify" id="perm-settings-modify">
                                        <span>Modify Settings</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="permission-section">
                                <h4>Printing (Available to All Users)</h4>
                                <div class="permission-items">
                                    <label class="permission-item">
                                        <input type="checkbox" checked disabled>
                                        <span>Print Documents</span>
                                        <small>All users can print documents and receipts</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn btn-success" onclick="savePermissions()">
                                <i class="fas fa-save"></i> Save Permissions
                            </button>
                            <button class="btn btn-primary" onclick="setDefaultPermissions()">
                                <i class="fas fa-undo"></i> Reset to Default
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- System Settings -->
                <div id="system-settings" class="settings-tab">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-cogs"></i> System Configuration</h3>
                        </div>
                        
                        <form onsubmit="saveSystemSettings(event)">
                            <div class="settings-section">
                                <h4>General Settings</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>System Theme:</label>
                                        <select id="systemTheme">
                                            <option value="blue">Professional Blue</option>
                                            <option value="dark">Dark Mode</option>
                                            <option value="green">Nature Green</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Date Format:</label>
                                        <select id="dateFormat">
                                            <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                            <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                            <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Time Format:</label>
                                        <select id="timeFormat">
                                            <option value="24">24 Hour</option>
                                            <option value="12">12 Hour</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="settings-section">
                                <h4>Business Settings</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="autoSave"> Auto Save Changes
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="lowStockAlerts"> Low Stock Alerts
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="emailNotifications"> Email Notifications
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="settings-section">
                                <h4>Receipt Settings</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Receipt Header:</label>
                                        <input type="text" id="receiptHeader" value="Thank you for your business!">
                                    </div>
                                    <div class="form-group">
                                        <label>Receipt Footer:</label>
                                        <input type="text" id="receiptFooter" value="Visit us again soon!">
                                    </div>
                                    <div class="form-group">
                                        <label>Print Logo on Receipt:</label>
                                        <input type="checkbox" id="printLogo">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> Save System Settings
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Backup Settings -->
                <div id="backup-settings" class="settings-tab">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-database"></i> Data Backup & Export</h3>
                        </div>
                        
                        <div class="backup-section">
                            <h4>Manual Backup</h4>
                            <p>Create a backup of all your data including inventory, customers, sales, and settings.</p>
                            <div class="backup-actions">
                                <button class="btn btn-success" onclick="createBackup()">
                                    <i class="fas fa-download"></i> Create Full Backup
                                </button>
                                <button class="btn btn-primary" onclick="restoreBackup()">
                                    <i class="fas fa-upload"></i> Restore from Backup
                                </button>
                            </div>
                        </div>
                        
                        <div class="export-section">
                            <h4>Data Export</h4>
                            <p>Export specific data to CSV files for external use.</p>
                            <div class="export-options">
                                <button class="btn btn-info" onclick="exportData('inventory')">
                                    <i class="fas fa-boxes"></i> Export Inventory
                                </button>
                                <button class="btn btn-info" onclick="exportData('customers')">
                                    <i class="fas fa-users"></i> Export Customers
                                </button>
                                <button class="btn btn-info" onclick="exportData('sales')">
                                    <i class="fas fa-shopping-cart"></i> Export Sales
                                </button>
                                <button class="btn btn-info" onclick="exportData('transactions')">
                                    <i class="fas fa-exchange-alt"></i> Export Transactions
                                </button>
                            </div>
                        </div>
                        
                        <div class="import-section">
                            <h4>Data Import</h4>
                            <p>Import data from CSV files. Make sure your files follow the required format.</p>
                            <div class="import-options">
                                <div class="import-item">
                                    <label for="inventoryFile">Import Inventory:</label>
                                    <input type="file" id="inventoryFile" accept=".csv">
                                    <button class="btn btn-primary" onclick="importData('inventory')">
                                        <i class="fas fa-upload"></i> Import
                                    </button>
                                </div>
                                <div class="import-item">
                                    <label for="customersFile">Import Customers:</label>
                                    <input type="file" id="customersFile" accept=".csv">
                                    <button class="btn btn-primary" onclick="importData('customers')">
                                        <i class="fas fa-upload"></i> Import
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-left">
                    <p>&copy; 2024 SalesManager 7.0 - Enhanced Business Management System</p>
                </div>
                <div class="footer-right">
                    <p>Developed by: <span id="developerName">Professional Development Team</span></p>
                    <p>Version: 7.0.1 | Last Updated: <span id="lastUpdated">2024</span></p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Receipt Template -->
    <div id="receiptTemplate" style="display: none;">
        <div class="receipt">
            <div class="receipt-header">
                <h2 id="receiptCompany">Company Name</h2>
                <p id="receiptAddress">Company Address</p>
                <p id="receiptContact">Phone: | Email:</p>
            </div>
            <div class="receipt-info">
                <p>Receipt #: <span id="receiptNumber"></span></p>
                <p>Date: <span id="receiptDate"></span></p>
                <p>Cashier: <span id="receiptCashier"></span></p>
            </div>
            <div class="receipt-items" id="receiptItems">
                <!-- Items will be populated here -->
            </div>
            <div class="receipt-totals">
                <div class="total-line">Subtotal: <span id="receiptSubtotal"></span></div>
                <div class="total-line">Tax: <span id="receiptTax"></span></div>
                <div class="total-line">Discount: <span id="receiptDiscount"></span></div>
                <div class="total-line grand-total">Total: <span id="receiptTotal"></span></div>
            </div>
            <div class="receipt-footer">
                <p>Thank you for your business!</p>
                <p>Visit us again soon!</p>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
    // Consolidated Script - Core App State and Helpers
    const notify = (msg, type = 'info') => {
        const c = document.getElementById('notificationContainer');
        const n = document.createElement('div');
        n.className = `notification ${type}`;
        n.innerHTML = `<i class="fas fa-${type==='success'?'check-circle':type==='error'?'exclamation-circle':type==='warning'?'exclamation-triangle':'info-circle'}"></i> ${msg}`;
        c.appendChild(n);
        setTimeout(()=> n.remove(), 3500);
    };

    // Global State
    const state = {
        config: { companyName: 'Enhanced Business Management System', currency: 'USD', enableTax: false, taxRate: 18 },
        currentUser: null,
        permissions: {},
        items: [],
        customers: [],
        suppliers: [],
        transactions: [],
        sales: [],
        cart: [],
        receiptCounter: 1000
    };

    // Utility
    const fmt = (n, curr = state.config.currency) => {
        const num = Number(n||0);
        const locales = curr==='UGX'?'en-UG':'en-US';
        const minFrac = curr==='UGX'?0:2;
        return `${curr} ${num.toLocaleString(locales,{minimumFractionDigits:minFrac, maximumFractionDigits:minFrac})}`;
    };

    // App Init
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('loginCompanyDisplay').textContent = state.config.companyName;
        initNavigation();
        initDefaults();
    });

    function initDefaults(){
        const today = new Date().toISOString().split('T')[0];
        ['transactionFromDate','transactionToDate','salesFromDate','salesToDate','reportFromDate','reportToDate'].forEach(id=>{
            const el = document.getElementById(id); if(el) el.value = today;
        });
        // Seed demo items
        state.items = [
            {id:'ITM-1', code:'EL-001', name:'LED TV 42"', category:'electronics', cost:200, price:300, stock:10, unit:'pcs', min:2, status:'active'},
            {id:'ITM-2', code:'FD-010', name:'Premium Coffee 1kg', category:'food', cost:6, price:12, stock:25, unit:'kg', min:5, status:'active'},
            {id:'ITM-3', code:'CL-220', name:'Denim Jacket', category:'clothing', cost:18, price:39, stock:8, unit:'pcs', min:3, status:'active'}
        ];
        refreshInventoryTable();
        refreshDashboard();
    }

    // Authentication
    function login(ev){
        ev.preventDefault();
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value.trim();
        const branch = document.getElementById('branch').value;
        if(!username || !password || !branch) return notify('Please fill in all login fields','error');
        // Simple: admin only demo
        if(username==='admin' && password==='admin123'){
            state.currentUser = { username, fullName:'System Administrator', role:'admin'};
            document.getElementById('currentUser').textContent = 'SYSTEM ADMINISTRATOR';
            document.getElementById('currentRole').textContent = 'Administrator';
            document.getElementById('currentBranch').textContent = branch;
            document.getElementById('companyDisplay').textContent = state.config.companyName;
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('app').classList.remove('app-hidden');
            notify('Login successful','success');
        } else {
            notify('Invalid credentials','error');
        }
    }
    function logout(){
        state.currentUser = null;
        document.getElementById('app').classList.add('app-hidden');
        document.getElementById('loginModal').style.display = 'flex';
        notify('Logged out','info');
    }

    // Permissions: all except print are admin-gated
    function can(action){
        if(!state.currentUser) return false;
        if(action==='print') return true; // printing allowed to all users
        return state.currentUser.role==='admin';
    }

    // Navigation
    function initNavigation(){
        const items = document.querySelectorAll('.nav-item');
        items.forEach(a => a.addEventListener('click', (e)=>{
            e.preventDefault();
            const section = a.getAttribute('data-section');
            // Check permission if gated
            const perm = a.getAttribute('data-permission');
            if(perm && !can('access')){ return notify('Access denied. Admin only.', 'error'); }
            document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
            a.classList.add('active');
            document.querySelectorAll('.content-section').forEach(s=>s.classList.remove('active'));
            document.getElementById(section).classList.add('active');
            if(section==='accounting') recalcAccounting();
        }));
    }

    // Dashboard
    function refreshDashboard(){
        const todayTotal = state.sales.filter(s=>s.date===new Date().toISOString().split('T')[0]).reduce((sum,s)=>sum+(s.total||0),0);
        document.getElementById('todaySales').textContent = fmt(todayTotal);
        document.getElementById('totalItems').textContent = state.items.length;
        const low = state.items.filter(i=>i.stock<= (i.min||0)).length;
        const lowEl = document.getElementById('lowStockAlert'); if(lowEl) lowEl.textContent = `Low Stock: ${low}`;
        document.getElementById('notificationCount').textContent = String(low);
    }
    function showNotifications(){ notify('No new notifications','info'); }
    function quickSale(){ document.querySelector('[data-section="sales"]').click(); openPOS(); }
    function addInventory(){ document.querySelector('[data-section="inventory"]').click(); addNewItem(); }
    function newCustomer(){ document.querySelector('[data-section="customers"]').click(); addNewCustomer(); }
    function viewReports(){ document.querySelector('[data-section="reports"]').click(); loadReportCategory('sales'); }
    function printDashboard(){ window.print(); }

    // Transactions (simplified wiring)
    function newTransaction(){ if(!can('create')) return notify('Admin only','error'); notify('New transaction form loaded','info'); }
    function printTransactions(){ window.print(); }
    function loadTransactionModule(){ notify('Transaction module loaded','info'); }
    function filterTransactions(){ /* no-op for demo */ }

    // POS / Sales
    function openPOS(){
        if(!can('create')) return notify('Admin only','error');
        document.getElementById('posInterface').style.display='grid';
        renderPOSItems(state.items);
        renderCart();
    }
    function newSale(){ openPOS(); }
    function printSales(){ window.print(); }
    function searchItems(){
        const q = (document.getElementById('itemSearch').value||'').toLowerCase();
        const filtered = state.items.filter(i=> [i.code,i.name,i.category].some(v=>String(v).toLowerCase().includes(q)));
        renderPOSItems(filtered);
    }
    function filterByCategory(cat){
        document.querySelectorAll('.category-btn').forEach(b=>b.classList.remove('active'));
        event.target.classList.add('active');
        renderPOSItems(cat==='all'? state.items : state.items.filter(i=>i.category===cat));
    }
    function renderPOSItems(list){
        const c = document.getElementById('posItems'); c.innerHTML='';
        if(list.length===0){ c.innerHTML = '<p style="color:#666">No items found</p>'; return; }
        const grid = document.createElement('div'); grid.style.display='grid'; grid.style.gridTemplateColumns='repeat(auto-fill,minmax(150px,1fr))'; grid.style.gap='10px';
        list.forEach(item=>{
            const d = document.createElement('div');
            d.style.border='2px solid #e1e8ed'; d.style.borderRadius='10px'; d.style.padding='10px'; d.style.cursor='pointer';
            d.innerHTML = `<div class="text-primary" style="font-weight:700;">${item.name}</div>
                <div style="color:#607d8b">Stock: ${item.stock} ${item.unit||'pcs'}</div>
                <div style="color:#2e7d32;font-weight:800;margin:6px 0;">${fmt(item.price)}</div>
                <button class="btn btn-primary btn-sm"><i class="fas fa-plus"></i> Add</button>`;
            d.querySelector('button').onclick = ()=> addToCart(item.id);
            grid.appendChild(d);
        });
        c.appendChild(grid);
    }
    function addToCart(id){
        const item = state.items.find(i=>i.id===id); if(!item) return;
        if(item.stock<=0) return notify('Out of stock','warning');
        const existing = state.cart.find(c=>c.id===id);
        if(existing){ if(existing.qty < item.stock){ existing.qty++; existing.total=existing.qty*existing.price; } }
        else { state.cart.push({ id, name:item.name, price:item.price, qty:1, total:item.price }); }
        renderCart();
    }
    function renderCart(){
        const c = document.getElementById('cartItems'); c.innerHTML='';
        if(state.cart.length===0){ c.innerHTML = `<div class="empty-cart"><i class="fas fa-shopping-cart"></i><p>Cart is empty</p></div>`; updateCartSummary(); return; }
        state.cart.forEach((ci, idx)=>{
            const row = document.createElement('div'); row.className='cart-item';
            row.innerHTML = `<div><strong>${ci.name}</strong><div style="color:#607d8b">${fmt(ci.price)} x ${ci.qty}</div></div>
            <div style="display:flex;gap:6px;align-items:center;">
                <button class="btn btn-warning btn-sm"><i class="fas fa-minus"></i></button>
                <div style="min-width:86px;text-align:right;font-weight:700">${fmt(ci.total)}</div>
                <button class="btn btn-primary btn-sm"><i class="fas fa-plus"></i></button>
                <button class="btn btn-secondary btn-sm"><i class="fas fa-trash"></i></button>
            </div>`;
            row.children[1].children[0].onclick = ()=> { if(ci.qty>1){ ci.qty--; ci.total=ci.qty*ci.price;} else { state.cart.splice(idx,1);} renderCart(); };
            row.children[1].children[2].onclick = ()=> { const item=state.items.find(i=>i.id===ci.id); if(ci.qty<item.stock){ ci.qty++; ci.total=ci.qty*ci.price; renderCart(); }};
            row.children[1].children[3].onclick = ()=> { state.cart.splice(idx,1); renderCart(); };
            c.appendChild(row);
        });
        updateCartSummary();
    }
    function updateCartSummary(){
        const sub = state.cart.reduce((s,c)=>s+c.total,0);
        const tax = state.config.enableTax? sub * (state.config.taxRate/100) : 0;
        const disc = 0;
        const tot = sub + tax - disc;
        document.getElementById('cartSubtotal').textContent = fmt(sub);
        document.getElementById('cartTax').textContent = fmt(tax);
        document.getElementById('cartDiscount').textContent = fmt(disc);
        document.getElementById('cartTotal').textContent = fmt(tot);
        return {sub, tax, disc, tot};
    }
    function clearCart(){ state.cart = []; renderCart(); notify('Cart cleared','info'); }
    function calculateChange(){ const { tot } = updateCartSummary(); const paid = Number(document.getElementById('amountPaid').value||0); const change = Math.max(0, paid-tot); document.getElementById('changeAmount').textContent = fmt(change); }
    function processPayment(){
        if(!can('create')) return notify('Admin only','error');
        if(state.cart.length===0) return notify('Cart is empty','warning');
        const {sub,tax,disc,tot} = updateCartSummary();
        const sale = { id:`POS-${Date.now()}`, date:new Date().toISOString().split('T')[0], items: JSON.parse(JSON.stringify(state.cart)), subtotal: sub, tax, discount: disc, total: tot, status:'completed', payment: document.getElementById('paymentMethod').value };
        state.sales.push(sale); state.transactions.push({id:sale.id,type:'pos-sale',date:sale.date,amount:tot,status:'completed'});
        // Reduce stock
        sale.items.forEach(ci=>{ const it = state.items.find(i=>i.id===ci.id); if(it) it.stock = Math.max(0, it.stock - ci.qty); });
        state.cart = []; renderCart(); refreshInventoryTable(); refreshDashboard();
        lastReceipt = buildReceiptDataFromSale(sale);
        notify('Payment processed','success');
    }
    function printReceipt(){ window.print(); }
    function filterSales(){ /* demo no-op */ }

    // Inventory
    function addNewItem(){ if(!can('create')) return notify('Admin only','error'); document.getElementById('inventoryForm').style.display='block'; }
    function stockAdjustment(){ if(!can('edit')) return notify('Admin only','error'); notify('Open stock adjustment form','info'); }
    function importItems(){ if(!can('create')) return notify('Admin only','error'); notify('Import wizard not implemented in demo','info'); }
    function exportInventory(){
        const header = 'Code,Name,Category,Stock,Cost,Price\n';
        const rows = state.items.map(i=>[i.code,i.name,i.category,i.stock,i.cost,i.price].join(',')).join('\n');
        downloadCSV('inventory_export.csv', header+rows);
        notify('Inventory exported','success');
    }
    function printInventory(){ window.print(); }
    function saveInventoryItem(ev){ ev.preventDefault(); if(!can('create')) return notify('Admin only','error');
        const get = id => document.getElementById(id).value;
        const item = {
            id:`ITM-${Date.now()}`,
            code:get('itemCode'), name:get('itemName'), category:get('itemCategory'), brand:get('itemBrand'), cost:Number(get('costPrice')||0), price:Number(get('sellingPrice')||0), unit:get('itemUnit'), stock:Number(get('initialStock')||0), min:Number(get('minStockLevel')||0), status:get('itemStatus')||'active'
        };
        if(!item.code || !item.name || !item.category) return notify('Please fill required fields','error');
        state.items.push(item); refreshInventoryTable(); document.getElementById('inventoryForm').style.display='none'; ev.target.reset(); refreshDashboard(); notify('Item saved','success');
    }
    function cancelItemForm(){ document.getElementById('inventoryForm').style.display='none'; }
    function clearItemForm(){ const form = document.querySelector('#inventoryForm form'); form && form.reset(); }
    function filterInventory(){ const q=(document.getElementById('inventorySearch').value||'').toLowerCase(); const cat=document.getElementById('categoryFilter').value; const stock=document.getElementById('stockFilter').value; const status=document.getElementById('statusFilter').value; let list=[...state.items]; if(q) list=list.filter(i=>[i.code,i.name,i.category].some(v=>String(v).toLowerCase().includes(q))); if(cat) list=list.filter(i=>i.category===cat); if(status) list=list.filter(i=>i.status===status); if(stock==='in-stock') list=list.filter(i=>i.stock>0); if(stock==='low-stock') list=list.filter(i=>i.stock<= (i.min||0) && i.stock>0); if(stock==='out-of-stock') list=list.filter(i=>i.stock===0); refreshInventoryTable(list);
    }
    function refreshInventoryTable(list){ const data = list||state.items; const tbody = document.getElementById('inventoryTableBody'); if(!tbody) return; if(!data.length){ tbody.innerHTML = '<tr class="no-records"><td colspan="9">No inventory items found. Add your first item above.</td></tr>'; return; } tbody.innerHTML = data.map(i=>`<tr><td>${i.code}</td><td>${i.name}</td><td>${i.category}</td><td>${i.stock} ${i.unit||'pcs'}</td><td>${fmt(i.cost)}</td><td>${fmt(i.price)}</td><td>${((i.price-i.cost)/Math.max(1,i.cost)*100).toFixed(0)}%</td><td>${i.status}</td><td><button class="btn btn-primary btn-sm" onclick="editItem('${i.id}')"><i class='fas fa-edit'></i></button></td></tr>`).join(''); }
    function editItem(id){ if(!can('edit')) return notify('Admin only','error'); notify('Edit item '+id,'info'); }

    // Customers
    function addNewCustomer(){ if(!can('create')) return notify('Admin only','error'); document.getElementById('customerForm').style.display='block'; }
    function saveCustomer(ev){ ev.preventDefault(); if(!can('create')) return notify('Admin only','error'); notify('Customer saved','success'); document.getElementById('customerForm').style.display='none'; ev.target.reset(); }
    function cancelCustomerForm(){ document.getElementById('customerForm').style.display='none'; }
    function clearCustomerForm(){ const f=document.querySelector('#customerForm form'); f && f.reset(); }
    function importCustomers(){ if(!can('create')) return notify('Admin only','error'); notify('Import wizard not implemented in demo','info'); }
    function exportCustomers(){ downloadCSV('customers_export.csv','ID,Name,Email,Phone\n'); notify('Customers exported','success'); }
    function printCustomers(){ window.print(); }
    function filterCustomers(){ /* demo */ }

    // Suppliers
    function addNewSupplier(){ if(!can('create')) return notify('Admin only','error'); notify('Add supplier form (demo)','info'); }
    function importSuppliers(){ if(!can('create')) return notify('Admin only','error'); notify('Import suppliers (demo)','info'); }
    function exportSuppliers(){ downloadCSV('suppliers_export.csv','ID,Company,Phone\n'); notify('Suppliers exported','success'); }
    function printSuppliers(){ window.print(); }

    // Accounting (summary only)
    function recalcAccounting(){
        const assets = state.items.reduce((s,i)=> s + i.stock * i.cost, 0);
        const liabilities = 0;
        const equity = assets + state.sales.reduce((s,sl)=> s + (sl.total||0), 0);
        const profit = state.sales.reduce((s,sl)=> s + (sl.total||0), 0) - state.items.reduce((s,i)=> s + i.stock * i.cost * 0.0, 0);
        setText('totalAssets', fmt(assets)); setText('totalLiabilities', fmt(liabilities)); setText('totalEquity', fmt(equity)); setText('netProfit', fmt(profit));
    }
    function setText(id, v){ const el = document.getElementById(id); if(el) el.textContent = v; }
    function openAccountingModule(k){ document.getElementById('accountingModuleContent').style.display='block'; document.getElementById('accountingModuleTitle').textContent = titleize(k); document.getElementById('accountingModuleBody').innerHTML = `<div class="empty-state"><i class='fas fa-cog'></i><h3>${titleize(k)} Module</h3><p>Content will appear here.</p></div>`; }
    function closeAccountingModule(){ document.getElementById('accountingModuleContent').style.display='none'; }

    // Reports (skeleton)
    function loadReportCategory(cat){ document.getElementById('reportContent').style.display='block'; document.getElementById('reportTitle').textContent = `${titleize(cat)} Reports`; document.getElementById('reportBody').innerHTML=''; }
    function generateReport(){ document.getElementById('reportBody').innerHTML = `<div class='card'><h3>Generated Report</h3><p>Total Sales: ${fmt(state.sales.reduce((s,a)=>s+(a.total||0),0))}</p></div>`; notify('Report generated','success'); }
    function exportReport(){ downloadCSV('report.csv','Metric,Value\nTotal Sales,'+ state.sales.reduce((s,a)=>s+(a.total||0),0)); notify('Report exported','success'); }
    function printReport(){ window.print(); }
    function closeReport(){ document.getElementById('reportContent').style.display='none'; }

    // Settings
    function showSettingsTab(name){
        document.querySelectorAll('.settings-tab').forEach(t=>t.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        event.target.classList.add('active');
        document.getElementById(name+'-settings').classList.add('active');
    }
    function saveCompanySettings(ev){ ev.preventDefault(); state.config.companyName = document.getElementById('companyName').value || state.config.companyName; state.config.currency = document.getElementById('companyCurrency').value || state.config.currency; state.config.enableTax = document.getElementById('enableTax').checked; state.config.taxRate = Number(document.getElementById('taxRate').value||18); document.getElementById('companyDisplay').textContent = state.config.companyName; document.getElementById('loginCompanyDisplay').textContent = state.config.companyName; notify('Company settings saved','success'); }
    function addNewUser(){ if(!can('create')) return notify('Admin only','error'); document.getElementById('userForm').style.display='block'; }
    function saveUser(ev){ ev.preventDefault(); if(!can('create')) return notify('Admin only','error'); document.getElementById('userForm').style.display='none'; notify('User saved (demo)','success'); }
    function cancelUserForm(){ document.getElementById('userForm').style.display='none'; }
    function editUser(){ if(!can('edit')) return notify('Admin only','error'); notify('Edit user (demo)','info'); }
    function savePermissions(){ if(!can('edit')) return notify('Admin only','error'); notify('Permissions saved','success'); }
    function setDefaultPermissions(){ if(!can('edit')) return notify('Admin only','error'); notify('Permissions reset to default','info'); }
    function saveSystemSettings(ev){ ev.preventDefault(); notify('System settings saved','success'); }

    // Backup/Export/Import
    function createBackup(){ const data = JSON.stringify(state); downloadBlob('salesmanager_backup.json', new Blob([data],{type:'application/json'})); notify('Backup created','success'); }
    function restoreBackup(){ notify('Restore flow not implemented in demo','info'); }
    function exportData(kind){ let csv=''; if(kind==='inventory'){ const header='Code,Name,Category,Stock,Cost,Price\n'; const rows = state.items.map(i=>[i.code,i.name,i.category,i.stock,i.cost,i.price].join(',')).join('\n'); csv = header+rows; downloadCSV('inventory.csv', csv); } else if(kind==='customers'){ downloadCSV('customers.csv',''); } else if(kind==='sales'){ const header='ID,Date,Items,Total\n'; const rows = state.sales.map(s=>[s.id,s.date,s.items.length,s.total].join(',')).join('\n'); csv = header+rows; downloadCSV('sales.csv', csv);} else if(kind==='transactions'){ const header='ID,Date,Type,Amount,Status\n'; const rows = state.transactions.map(t=>[t.id,t.date,t.type,t.amount,t.status].join(',')).join('\n'); csv = header+rows; downloadCSV('transactions.csv', csv);} notify('Export complete','success'); }
    function importData(kind){ notify('Import flow not implemented in demo','info'); }

    // Barcode (demo)
    function generateBarcode(){ notify('Barcode generated (demo)','info'); }

    // Receipts
    let lastReceipt = null;
    function buildReceiptDataFromSale(s){
        return {
            company: state.config.companyName,
            number: 'R'+ (++state.receiptCounter),
            date: new Date().toLocaleString(),
            cashier: state.currentUser?.fullName || 'USER',
            items: s.items,
            subtotal: s.subtotal,
            tax: s.tax,
            discount: s.discount,
            total: s.total
        };
    }

    // Helpers download
    function downloadCSV(filename, content){ downloadBlob(filename, new Blob([content],{type:'text/csv'})); }
    function downloadBlob(filename, blob){ const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = filename; document.body.appendChild(a); a.click(); setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 0); }
    function titleize(s){ return String(s||'').replace(/-/g,' ').replace(/\b\w/g, c=>c.toUpperCase()); }
    </script>
</body>
</html>
